# Terraform AWS Infrastructure

Terraformμ„ μ‚¬μ©ν•μ—¬ AWS μΈν”„λΌ(VPC, Subnet, Security Group, EC2)λ¥Ό
μ½”λ“(IaC)λ΅ κ΄€λ¦¬ν•λ” μΈν”„λΌ λ ν¬μ§€ν† λ¦¬μ…λ‹λ‹¤.

ν„μ¬λ” Big-Bang λ°°ν¬λ¥Ό κΈ°μ¤€μΌλ΅ ν• λ‹¨μν• μΈν”„λΌ κµ¬μ„±μ„ λ‹¤λ£¨κ³  μμ§€λ§,
μ„λΉ„μ¤μ™€ μΈν”„λΌ κµ¬μ΅°κ°€ λ³€ν™”ν•¨μ— λ”°λΌ
ν•΄λ‹Ή λ ν¬μ§€ν† λ¦¬ λν• μ μ§„μ μΌλ΅ ν™•μ¥Β·κ°μ„ ν•΄ λ‚κ° μμ •μ…λ‹λ‹¤.

## π“ Project Structure

```
terraform/
β”β”€β”€ .terraform.lock.hcl     # Provider λ²„μ „ κ³ μ • νμΌ (ν€ κ°„ λ™μΌν• μ‹¤ν–‰ ν™κ²½ λ³΄μ¥)
β”β”€β”€ main.tf                 # μ£Όμ” μΈν”„λΌ λ¦¬μ†μ¤ μ •μ (VPC, Subnet, SG, EC2)
β”β”€β”€ providers.tf            # Terraform λ° AWS Provider μ„¤μ •
β”β”€β”€ variables.tf            # μΈν”„λΌμ—μ„ μ‚¬μ©ν•λ” λ³€μ μ •μ
β”β”€β”€ outputs.tf              # apply ν›„ ν™•μΈν•  μ¶λ ¥ κ°’ μ •μ (Public IP, DNS λ“±)
β”β”€β”€ .gitignore              # Gitμ— ν¬ν•¨λμ§€ μ•μ•„μ•Ό ν•  νμΌ/λ””λ ‰ν† λ¦¬ μ •μ
β””β”€β”€ README.md               # μΈν”„λΌ λ ν¬ μ„¤λ… λ° μ‚¬μ© κ°€μ΄λ“

```

## π“ Prerequisites

Terraformμ„ μ‹¤ν–‰ν•κΈ° μ„ν•΄ μ•„λ λ„κµ¬λ“¤μ΄ ν•„μ”ν•©λ‹λ‹¤.
MacOS λ²„μ „μΌλ΅ μ‘μ„±λμ—μµλ‹λ‹¤.

### 1. Terraform μ„¤μΉ

```bash
brew update
brew install terraform

# μ„¤μΉλ λ²„μ „ ν™•μΈ
terraform -version
```

### 2. AWS CLI μ„¤μΉ

```bash
brew install awscli
aws --version
```

### 3. AWS μκ²©μ¦λ… μ„¤μ •

- Terraformμ€ AWS CLI μκ²©μ¦λ…μ„ μ‚¬μ©ν•©λ‹λ‹¤.
  - AWS κ³„μ •μ AWS Access Key / Secret Keyλ¥Ό λ°κΈ‰λ°›μ•„ μ•„λ λ…λ Ήμ–΄λ΅ μ„¤μ •ν•©λ‹λ‹¤.
  - μ‹¤μ  Access Key / Secret Key κ°’μ€ Gitμ— μ»¤λ°‹ν•μ§€ μ•λ„λ΅ μ£Όμν•΄μ•Όν•©λ‹λ‹¤.

```bash
aws configure
```

## β–¶οΈ How to Run

```
# ====== μ‚¬μ „ μ‘μ—… ======

# μ½”λ“ ν¬λ§·λ§ μ •λ¦¬
terraform fmt -recursive

# Terraform λ¬Έλ²• λ° κµ¬μ΅° κ²€μ¦
terraform init

# Terraform λ¬Έλ²• λ° κµ¬μ΅° κ²€μ¦
terraform validate

# λ³€κ²½ μ‚¬ν•­ λ―Έλ¦¬ ν™•μΈ (AWS λ¦¬μ†μ¤ μƒμ„± X)
terraform plan

# ====== μ‹¤ν–‰ ======

# AWS μΈν”„λΌ μƒμ„±
terraform apply


# ====== κ²°κ³Όλ¬Ό ν™•μΈ λ° λ™μ‘ ν™•μΈ ======

# apply κ²°κ³Ό μ¶λ ¥ κ°’ ν™•μΈ
terraform output

# SSH μ ‘μ†ν•μ—¬ λ™μ‘ ν™•μΈ
ssh -i <your-key.pem> ubuntu@<public_ip>

# ====== μ‚­μ  ======

# μ‚­μ  κ³„ν ν™•μΈ
terraform plan -destroy

# μƒμ„±λ λ¦¬μ†μ¤ μ‹¤μ  μ‚­μ 
terraform destroy

```

## π“¦ Terraform State Management : AWS S3

Terraform stateλ” ν„μ¬ μΈν”„λΌμ μ‹¤μ  μƒνƒλ¥Ό κΈ°λ΅ν•λ” ν•µμ‹¬ μ •λ³΄λ΅,
λ΅μ»¬μ— μ €μ¥ν•  κ²½μ° μ‚¬μ©μλ³„ μƒνƒ λ¶μΌμΉ λ° ν‘μ—… μ‹ μ¶©λ μ„ν—μ΄ μ΅΄μ¬ν•©λ‹λ‹¤.
μ΄λ¥Ό λ°©μ§€ν•κΈ° μ„ν•΄ μƒνƒλ¥Ό μ¤‘μ•™ μ €μ¥μ†μ—μ„ κ΄€λ¦¬ν•λ” κ²ƒμ΄ Best Practiceλ΅ μ•λ ¤μ Έ μμµλ‹λ‹¤.

### [ Best Practice : S3 + DynamoDB ]

Terraform κ³µμ‹ λ¬Έμ„μ™€ μ‹¤λ¬΄ μ‚¬λ΅€μ—μ„λ” λ³΄ν†µ λ‹¤μ μ΅°ν•©μ„ κ¶μ¥ν•©λ‹λ‹¤.

- **S3**: Terraform state νμΌμ„ μ¤‘μ•™μ—μ„ μ•μ „ν•κ² μ €μ¥ν•κΈ° μ„ν• μ €μ¥μ†
- **DynamoDB**: state λ³€κ²½ μ‹ λ™μ‹ μ‹¤ν–‰μ„ λ°©μ§€ν•κΈ° μ„ν• μƒνƒ μ κΈ(State Locking) μ©λ„

### [ κ²°μ • : AWS S3 ]

- μΈν”„λΌκ°€ μ΄λ―Έ AWS ν™κ²½μ—μ„ μ΄μλκ³  μμ–΄ λ³„λ„μ μ™Έλ¶€ μ €μ¥μ†λ¥Ό μ¶”κ°€ν•  ν•„μ”κ°€ μ—†μ—κ³ 
- ν€ λ‚΄μ—μ„ S3 μ‚¬μ© κ²½ν—μ΄ μμ–΄ ν•™μµ λΉ„μ© μ—†μ΄ λ°”λ΅ μ μ©ν•  μ μμ—μΌλ©°
- ν„μ¬ μΈν”„λΌλ¥Ό κ΄€λ¦¬ν•λ” μΈμ›μ΄ λ§μ§€ μ•μ•„ <br>
  λ™μ‹μ— Terraformμ„ μ‹¤ν–‰ν•  κ°€λ¥μ„±μ΄ λ‚®λ‹¤κ³  νλ‹¨ν–κΈ° λ•λ¬Έμ…λ‹λ‹¤.

λ¶ν•„μ”ν• κµ¬μ„± μ”μ†λ¥Ό μ²μλ¶€ν„° μ¶”κ°€ν•κΈ°λ³΄λ‹¤λ”,
**μ΄μ λ³µμ΅λ„λ¥Ό μµμ†ν™”ν•λ©΄μ„ ν•„μ”ν• μμ¤€μ μ•μ •μ„±λ§ ν™•λ³΄ν•λ” λ°©ν–¥**μ„ μ„ νƒν–μµλ‹λ‹¤.

ν–¥ν›„ μΈν”„λΌ κ·λ¨κ°€ μ»¤μ§€κ±°λ‚,
Terraformμ„ λ™μ‹μ— μ‚¬μ©ν•λ” μΈμ›μ΄ λμ–΄λ‚  κ²½μ°μ—λ”
**DynamoDBλ¥Ό ν†µν• State Locking λ„μ…μ„ κ²€ν† ν•  μμ •**μ…λ‹λ‹¤.

## β οΈ Notes

- λ³Έ λ ν¬λ” μ‹¤μ  AWS λ¦¬μ†μ¤λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
- `terraform apply` μ‹¤ν–‰ μ‹ κ³ΌκΈμ΄ λ°μƒν•  μ μμµλ‹λ‹¤.
- μ‹¤ν–‰ μ „ λ°λ“μ‹ μ‚¬μ© μ¤‘μΈ AWS κ³„μ •κ³Ό λ¦¬μ „μ„ ν™•μΈν•μ„Έμ”.
