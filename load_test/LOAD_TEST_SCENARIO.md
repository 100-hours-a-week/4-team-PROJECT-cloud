# MINE 부하 테스트 시나리오

## 1. 서비스 규모 가정 (MVP1)

- **CCU (Concurrent Users)**: 3명
- **DAU (Daily Active Users)**: 57명
- **MAU (Monthly Active Users)**: 142명

### 1.1 사용자 행동 패턴 분석

**DAU 57명 기준:**
- 평균 동시 접속자 (CCU): 3명
- 피크 타임 동시 접속자: 5~10명 (저녁 7~9시 집중)
- 1일 평균 세션 수: 57명 × 1.5회 = 약 85 세션/일
- 시간당 평균 요청: 85 / 24 = 약 3.5 세션/시간
- 피크 타임 시간당 요청: 약 20~30 세션/시간

**MAU 142명 기준:**
- 월 활성 사용자 중 일일 활동률: 57/142 = 약 40%
- 신규 유입: 주 5~10명 예상
- 이탈률: 주 3~5명 예상

## 2. 부하 테스트 시나리오

### 2.1 시나리오 A: 정상 운영 (Normal Load)

**목적**: 일상적인 사용량에서 서비스 안정성 확인

**설정:**
```bash
locust -f load_test/scenario/first_learning.py \
  --host=http://3.39.31.181:8080 \
  --users 3 \
  --spawn-rate 1 \
  --run-time 10m \
  --headless
```

**기대 결과:**
- 성공률: ≥ 99%
- 평균 응답 시간: < 200ms (일반 API)
- 5xx 에러율: ≤ 1%

**측정 지표:**
- 각 API별 평균 응답 시간
- 요청 성공률
- 에러 발생 패턴

---

### 2.2 시나리오 B: 피크 타임 (Peak Load)

**목적**: 저녁 시간대 사용자 집중 상황 시뮬레이션

**설정:**
```bash
locust -f load_test/scenario/first_learning.py \
  --host=http://3.39.31.181:8080 \
  --users 10 \
  --spawn-rate 2 \
  --run-time 10m \
  --headless
```

**시나리오 설명:**
- 저녁 7~9시 사이 사용자가 몰리는 상황
- DAU 57명 중 30~40%가 2시간 내 집중 접속
- 동시 접속자 최대 10명까지 증가

**기대 결과:**
- 성공률: ≥ 99%
- 평균 응답 시간: < 300ms (일반 API)
- 5xx 에러율: ≤ 1%
- DB 커넥션 풀 부족 현상 없음

---

### 2.3 시나리오 C: 점진적 증가 (Ramp-up Test)

**목적**: 사용자 증가에 따른 시스템 반응 확인

**설정:**
```bash
locust -f load_test/scenario/first_learning.py \
  --host=http://3.39.31.181:8080 \
  --users 15 \
  --spawn-rate 0.5 \
  --run-time 15m \
  --headless
```

**시나리오 설명:**
- 0분: 0명
- 10분: 5명 (0.5명/초로 서서히 증가)
- 20분: 10명
- 30분: 15명 (CCU의 5배)

**기대 결과:**
- 사용자 증가에 따른 응답 시간 추이 관찰
- 병목 지점 파악 (DB, API, Nginx 등)
- 15명까지 안정적 동작 확인

---

### 2.4 시나리오 D: 스트레스 테스트 (Stress Test)

**목적**: 시스템 한계 파악 및 장애 시나리오 대비

**설정:**
```bash
locust -f load_test/scenario/first_learning.py \
  --host=http://3.39.31.181:8080 \
  --users 50 \
  --spawn-rate 5 \
  --run-time 5m \
  --headless
```

**시나리오 설명:**
- MVP1 예상 사용자 수를 크게 초과하는 상황
- 갑작스러운 바이럴/홍보 효과 시뮬레이션
- CCU 50명 = 예상 CCU의 약 17배

**측정 목표:**
- 어느 시점에서 시스템이 불안정해지는지 파악
- 5xx 에러 발생 시점 확인
- DB 커넥션 풀, 메모리, CPU 사용량 모니터링
- 장애 복구 시간 측정

**예상 결과:**
- 성공률 저하 예상
- 응답 시간 급격히 증가 예상
- 시스템 리소스 병목 확인

---

## 3. 테스트 순서 (권장)

### Phase 1: 기본 검증
1. **시나리오 A (정상 운영)** 실행
   - 3명, 10분
   - 기본 동작 확인

### Phase 2: 피크 대비
2. **시나리오 B (피크 타임)** 실행
   - 10명, 10분
   - 피크 시간대 대응 능력 확인

### Phase 3: 확장성 테스트
3. **시나리오 C (점진적 증가)** 실행
   - 0→15명, 15분
   - 증가 추이에 따른 성능 변화 관찰

### Phase 4: 한계 테스트
4. **시나리오 D (스트레스)** 실행
   - 50명, 5분
   - 시스템 한계 파악

---

## 4. 측정 지표 (SLI)

### 4.1 Backend API (first_learning 시나리오)

| API | 목표 평균 응답 시간 | 목표 성공률 |
|-----|-------------------|------------|
| GET /users/me | < 100ms | ≥ 99% |
| GET /categories | < 100ms | ≥ 99% |
| GET /categories/{id}/keywords | < 150ms | ≥ 99% |
| POST /cards | < 200ms | ≥ 99% |
| POST /cards/{id}/attempts | < 200ms | ≥ 99% |
| GET /cards/{id}/attempts/{id} | < 150ms | ≥ 99% |

### 4.2 전체 시스템

- **5xx 에러율**: ≤ 1%
- **4xx 에러율**: ≤ 5% (인증 실패 등 클라이언트 오류 포함)
- **평균 Throughput**: 시나리오 A 기준 최소 0.5 req/s

---

## 5. 모니터링 체크리스트

### 테스트 실행 중 확인 사항

**서버 리소스:**
- [ ] CPU 사용률 (평균, 최대)
- [ ] 메모리 사용률
- [ ] DB 커넥션 풀 사용량
- [ ] Nginx 동시 연결 수

**애플리케이션:**
- [ ] Backend 로그에 에러 없음
- [ ] DB 슬로우 쿼리 발생 여부
- [ ] Nginx access log 5xx 에러 수

**네트워크:**
- [ ] 네트워크 I/O 대역폭
- [ ] 응답 지연 (latency)

---

## 6. 결과 기록 템플릿

### 테스트 결과 기록

**시나리오:** [A/B/C/D]
**일시:** YYYY-MM-DD HH:MM
**설정:** Users=X, Spawn-rate=Y, Run-time=Z

**결과:**
```
총 요청 수:
성공:
실패:
성공률:

평균 응답 시간:
P50:
P95:
P99:

5xx 에러:
4xx 에러:
```

**이슈 사항:**
-

**개선 필요 사항:**
-

---

## 7. 다음 단계

### 7.1 AI 서버 부하 테스트 (추후)

AI 서버 가동 후 음성 분석 API 테스트 필요:

- **대상 API**: POST /ai/api/v1/analysis/solo
- **SLO**: p95 ≤ 90초
- **주의사항**:
  - STT/LLM 비용 발생 → 테스트 횟수 제한 필요
  - Warmup 시간 제외하고 측정
  - CloudWatch Logs에서 Nginx request_time 기반 p95 산출

### 7.2 장기 안정성 테스트 (Soak Test)

- 24시간 연속 운영 테스트
- 메모리 릭, 리소스 고갈 여부 확인
- CCU 3명 기준으로 24시간 지속

### 7.3 실제 사용자 모니터링

- CloudWatch 대시보드 구축
- Nginx access log → CloudWatch Logs 수집
- 실제 사용자 패턴 분석 및 시나리오 개선
